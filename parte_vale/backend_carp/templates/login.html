{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login Cliente</title>

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #ecc665ff 0%, #e6dcc4 50%, #f0c851ff 100%);
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .login-container {
      width: 400px;
      background: #fcf6d3ff;
      border: 2px solid #d4c59a;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 8px 20px rgba(180, 160, 100, 0.25);
      text-align: center;
    }

    .login-logo { width: 70px; margin-bottom: 15px; }

    .section-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: #5c5134;
      margin-bottom: 12px;
    }

    .field { margin-bottom: 14px; text-align: left; }

    input, select {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1.5px solid #d1b96fff;
      background: #eedb8fff;
      font-size: 1rem;
    }

    .btn {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 10px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(45deg, #f0c95dff, #f3b823ff);
      color: #4b3e22;
    }

    .btn.secondary {
      background: #f1e577ff;
      color: #6b5a1e;
    }

    .link-back {
      display: block;
      margin-top: 15px;
      color: #b89e5c;
      text-decoration: none;
      font-weight: 500;
    }

    .error-msg {
      color: #a94442;
      font-weight: bold;
      background-color: #f5c772ff;
      border: 1px solid #f5c6cb;
      padding: 10px;
      margin-bottom: 12px;
    }

    .forget {
      margin-top: 8px;
      display: block;
      color: #8c7a4d;
      font-size: 14px;
      text-decoration: underline;
    }
  </style>
</head>

<body>
  <div class="login-container">
    <img class="login-logo" src="{% static 'img/img/logo_rl.jpg' %}" alt="Logo">

    {% if error %}
      <div class="error-msg">{{ error }}</div>
    {% endif %}

    <form method="POST" action="{% url 'login' %}">
      {% csrf_token %}
      <div class="section-title">Iniciar sesión</div>

      <!-- CAMPOS NORMALES SOLO PARA CLIENTES -->
      <div class="field" id="campo_tipo_doc">
        <select name="tipo_doc" id="tipo_doc">
          <option value="">Seleccione tipo de documento</option>
          <option value="cc">Cédula de ciudadanía</option>
          <option value="ti">Tarjeta de identidad</option>
          <option value="ce">Cédula de extranjería</option>
          <option value="pp">Pasaporte</option>
        </select>
      </div>

      <div class="field" id="campo_num_doc">
        <input name="num_doc" type="text" placeholder="Número de documento" id="num_doc">
      </div>

      <div class="field">
        <input name="username" type="text" placeholder="Nombre de usuario" required id="username">
      </div>

      <div class="field" id="campo_email">
        <input name="email" type="email" placeholder="Correo electrónico" id="email">
      </div>

      <div class="field">
        <input name="password" type="password" placeholder="Contraseña" required>
      </div>

      <button type="submit" class="btn">Entrar</button>

      <!-- NUEVO BOTÓN -->
      <a href="#" class="forget">¿Olvidaste tu contraseña?</a>

      <br>

      <a href="{% url 'register' %}" class="btn secondary">Registrarse</a>
      <a href="{% url 'index' %}" class="link-back">Volver al inicio</a>
    </form>
  </div>

  <!-- SCRIPT PARA DETECTAR ADMIN -->
  <script>
    const usernameInput = document.getElementById("username");

    usernameInput.addEventListener("input", () => {
        const username = usernameInput.value.trim();

        if (!username) return;

        fetch(`/api/check-admin/${username}/`)
          .then(res => res.json())
          .then(data => {
              const isAdmin = data.is_admin;

              const campos = {
                tipoDoc: document.getElementById("campo_tipo_doc"),
                numDoc: document.getElementById("campo_num_doc"),
                email: document.getElementById("campo_email"),
              };

              if (isAdmin) {
                campos.tipoDoc.style.display = "none";
                campos.numDoc.style.display = "none";
                campos.email.style.display = "none";
              } else {
                campos.tipoDoc.style.display = "block";
                campos.numDoc.style.display = "block";
                campos.email.style.display = "block";
              }
          })
          .catch(err => console.log(err));
    });
  </script>

</body>
</html>
