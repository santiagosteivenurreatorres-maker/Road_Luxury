{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Road Luxury - Catálogo de Vehículos</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        .vehicles-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .vehicle-card { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); position: relative; }
        .vehicle-image img { width: 100%; height: 200px; object-fit: cover; border-radius: 10px; }
        .vehicle-name { font-weight: bold; font-size: 1.2rem; margin: 10px 0; }
        .vehicle-details span { display: inline-block; margin-right: 10px; font-size: 0.9rem; }
        .price { font-weight: bold; color: #d4af37; font-size: 1.2rem; margin: 10px 0; }
        .btn { display: block; width: 100%; padding: 10px; border: none; border-radius: 6px; color: white; cursor: pointer; margin-top: 5px; text-align: center; text-decoration: none; }
        .btn-calc { background: #007bff; }
        .btn-reserve { background: #28a745; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .availability { position: absolute; top: 10px; left: 10px; padding: 5px 10px; border-radius: 10px; color: white; font-size: 0.8rem; }
        .available { background: #28a745; }
        .limited { background: #ffc107; color: #000; }
        .unavailable { background: #dc3545; }
        .calculator { margin-top: 10px; padding: 10px; border: 1px solid #ccc; border-radius: 6px; display: none; background: #f8f8f8; }
        .calculator input { width: 100%; padding: 5px; margin-bottom: 5px; border-radius: 4px; border: 1px solid #ccc; }
        .total { font-weight: bold; margin-top: 5px; }
    </style>
</head>
<body>
<div class="container">
    <h1>Catálogo de Vehículos</h1>

    <div class="vehicles-grid">
        {% for v in vehiculos %}
            <div class="vehicle-card" data-id="{{ v.id }}">
                <div class="vehicle-image">
                    {% if v.image %}
                        <img src="{{ v.image.url }}" alt="{{ v.name }}">
                    {% else %}
                        <img src="{% static 'img/no-image.png' %}" alt="Sin imagen">
                    {% endif %}
                    <div class="availability {% if v.availability == 'available' %}available{% elif v.availability == 'limited' %}limited{% else %}unavailable{% endif %}">
                        {% if v.availability == 'available' %}Disponible{% elif v.availability == 'limited' %}Limitado{% else %}No disponible{% endif %}
                    </div>
                </div>

                <div class="vehicle-name">{{ v.name }}</div>
                <div class="vehicle-details">
                    <span>Año: {{ v.year }}</span>
                    <span>Motor: {{ v.engine }}</span>
                    <span>Potencia: {{ v.power }}</span>
                </div>
                <div class="vehicle-details">
                    <span>Transmisión: {{ v.transmission }}</span>
                    <span>Combustible: {{ v.fuel }}</span>
                </div>
                <div class="price">Precio/día: ${{ v.price }}</div>

                <button class="btn btn-calc" {% if v.availability == 'unavailable' %}disabled{% endif %}>Calcular Alquiler</button>

                <div class="calculator">
                    <input type="number" class="days" min="1" value="1" placeholder="Número de días">
                    <div class="total">Total: $0</div>
                </div>

                <a href="{% url 'reservar_vehiculo' v.id %}" class="btn btn-reserve" {% if v.availability == 'unavailable' %}disabled{% endif %}>Hacer Reserva</a>
            </div>
        {% empty %}
            <p>No hay vehículos disponibles.</p>
        {% endfor %}
    </div>
</div>

<script>
document.querySelectorAll('.btn-calc').forEach(button => {
    button.addEventListener('click', () => {
        const card = button.closest('.vehicle-card');
        const calc = card.querySelector('.calculator');
        calc.style.display = calc.style.display === 'block' ? 'none' : 'block';
        calculateTotal(card);
    });
});

document.querySelectorAll('.days').forEach(input => {
    input.addEventListener('input', (e) => {
        const card = e.target.closest('.vehicle-card');
        calculateTotal(card);
    });
});

function calculateTotal(card) {
    const daysInput = card.querySelector('.days');
    const days = parseInt(daysInput.value) || 1;
    const price = parseInt(card.querySelector('.price').textContent.replace(/\D/g,'')) || 0;
    const subtotal = price * days;
    const seguro = subtotal * 0.15;
    const iva = subtotal * 0.19;
    const total = subtotal + seguro + iva;
    card.querySelector('.total').textContent = `Total: $${total.toLocaleString('es-CO')}`;
}
</script>
</body>
</html>
